<!DOCTYPE HTML>
<html>
	<head>
		<title>Bringing Sport and AI Together - Mathieu Isoard</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="Bringing Sport and AI Together - A personal project by Mathieu Isoard exploring the intersection of sports analytics and machine learning." />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="index.html">Mathieu Isoard</a></h1>
						<nav id="nav">
							<ul>
								<li class="special">
									<a href="#menu" class="menuToggle"><span>Menu</span></a>
									<div id="menu">
										<ul>
											<li><a href="index.html">Home</a></li>
											<li><a href="about.html">About</a></li>
											<li><a href="cv.html">CV</a></li>
											<li><a href="projects.html">Projects</a></li>
											<li><a href="publications.html">Publications</a></li>
											<li><a href="contact.html">Contact</a></li>
										</ul>
									</div>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<article id="main">
						<header>
							<h2>Bringing Sport and AI Together</h2>
							<p>Where passion for sport meets expertise in artificial intelligence</p>
						</header>
						<section class="wrapper style5">
							<div class="inner">

								<h3>The Vision</h3>
								<p>
									
								</p>
								<p>
									
								</p>

								<hr />

								
						

								<h3>Why This Matters</h3>
								<p>
									
								</p>
								<p>
									This project is a work in progress. 
								</p>

								<hr />

								<h3>What does the app do?</h3>
								<div class="row">
									<div class="col-6 col-12-medium">
										<h4><span class="icon solid fa-running"></span> &nbsp; Efficient Gym Notes converter</h4>
										<p>
											Using 
										</p>
									</div>
									<div class="col-6 col-12-medium">
										<h4><span class="icon solid fa-calendar"></span> &nbsp; Workout session tracker</h4>
										<p> 
											Predictive models 
										</p>
									</div>
								</div>
								<div class="row">
									<div class="col-6 col-12-medium">
										<h4><span class="icon solid fa-chart-line"></span> &nbsp; Progress tracker</h4>
										<p>
											Real-time and
										</p>
									</div>

								</div>


								<hr />

								<h3>Want to try it?</h3>
								<p>
									Type your workout notes below &mdash; just like you'd jot them in a notebook &mdash; and watch the AI
									parse them into a structured session. You have <strong>2 attempts</strong> to try it out.
								</p>

								<div class="row gtr-200">
									<!-- Input side -->
									<div class="col-6 col-12-medium">
										<div style="display: flex; align-items: baseline; justify-content: space-between; gap: 0.5em; margin-bottom: 0.5em;">
											<h4 style="margin: 0;">Your raw notes</h4>
											<a href="#" class="button small" onclick="loadExample(); return false;" style="font-size: 0.65em; padding: 0 1.5em; white-space: nowrap;">Generate an example</a>
										</div>
										<textarea id="demo-input" rows="12" placeholder="Example:
Bench press 4x10 80kg rest 1min30
Superset:
  Bicep curl 3x12 14kg
  Tricep pushdown 3x12 20kg
  rest 45s
Running 30min 5km"></textarea>
										<ul class="actions" style="margin-top: 1em;">
											<li><button id="demo-parse-btn" class="button primary" onclick="parseSession()">
												<span id="btn-text">Parse Session</span>
												<span id="btn-loader" style="display:none;">Parsing...</span>
											</button></li>
											<li><button class="button small" onclick="loadTestData()">Test with sample data</button></li>
											<li><span id="demo-attempts" style="line-height: 3.125em; font-size: 0.85em; color: #888;">2 attempts remaining</span></li>
										</ul>
										<p id="demo-error" style="display:none; color:#ed4933; margin-top:0.5em; font-size:0.9em;"></p>
									</div>

									<!-- Output side -->
									<div class="col-6 col-12-medium">
										<h4>Structured session</h4>
										<div id="demo-output" class="demo-output-area">
											<div class="demo-placeholder">
												<span class="icon solid fa-dumbbell" style="font-size:2em; color:#ccc;"></span>
												<p style="color:#999; margin-top:0.5em;">Your parsed session will appear here</p>
											</div>
										</div>
									</div>
								</div>

								<hr />

								<ul class="actions">
									<li><a href="projects.html" class="button primary">Back to All Projects</a></li>
									<li><a href="contact.html" class="button">Get in Touch</a></li>
								</ul>

							</div>
						</section>
					</article>

				<!-- Footer -->
					<footer id="footer">
						<ul class="icons">
							<li><a href="https://www.linkedin.com/in/mathieu-isoard-ml" target="_blank" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li>
							<li><a href="https://github.com/misoard" target="_blank" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
							<li><a href="https://scholar.google.com/citations?user=8bsIOgoAAAAJ&hl=fr" target="_blank" class="icon solid fa-graduation-cap"><span class="label">Google Scholar</span></a></li>
							<li><a href="mailto:isoard.mathieu@gmail.com" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<ul class="copyright">
							<li>&copy; 2025 Mathieu Isoard</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

		<!-- Demo styles -->
		<style>
			/* Input textarea */
			#demo-input {
				width: 100%;
				min-height: 260px;
				padding: 1em;
				border: 2px solid #dfdfdf;
				border-radius: 12px;
				font-family: 'Courier New', monospace;
				font-size: 0.9em;
				line-height: 1.6;
				color: #2E3842;
				background: #fafafa;
				resize: vertical;
				transition: border-color 0.2s;
			}
			#demo-input:focus {
				border-color: #ed4933;
				outline: none;
				background: #fff;
			}
			#demo-input::placeholder {
				color: #aaa;
			}

			/* Output area — force sans-serif to match app */
			.demo-output-area {
				min-height: 260px;
				padding: 1em;
				border: 2px solid #dfdfdf;
				border-radius: 12px;
				background: #f8f9fa;
				overflow-y: auto;
				max-height: 600px;
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, Helvetica, Arial, sans-serif;
			}
			.demo-output-area * {
				font-family: inherit;
			}
			.demo-placeholder {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				min-height: 220px;
				text-align: center;
			}

			/* Block card */
			.demo-block {
				border: 2px solid #e5e7eb;
				border-radius: 16px;
				overflow: hidden;
				margin-bottom: 1em;
				background: #fff;
				transition: box-shadow 0.2s;
			}
			.demo-block:hover {
				box-shadow: 0 2px 8px rgba(0,0,0,0.08);
			}
			.demo-block:last-child {
				margin-bottom: 0;
			}

			/* Block header */
			.demo-block-header {
				display: flex;
				align-items: center;
				gap: 0.75em;
				padding: 0.75em 1em;
				background: rgba(255,255,255,0.8);
				border-bottom: 1px solid #f3f4f6;
				cursor: pointer;
			}
			.demo-block-icon {
				width: 36px;
				height: 36px;
				border-radius: 12px;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-shrink: 0;
				font-size: 1em;
			}
			.demo-block-icon.single { background: #f3f4f6; color: #4b5563; }
			.demo-block-icon.superset { background: #dbeafe; color: #2563eb; }
			.demo-block-icon.circuit { background: #ede9fe; color: #7c3aed; }
			.demo-block-icon.cardio { background: #dcfce7; color: #16a34a; }

			.demo-block-info {
				flex: 1;
				min-width: 0;
			}
			.demo-block-name {
				font-weight: 700;
				font-size: 0.95em;
				color: #111827;
				margin: 0;
				line-height: 1.3;
				display: flex;
				align-items: center;
				gap: 0.5em;
				flex-wrap: wrap;
			}
			.demo-block-meta {
				font-size: 0.8em;
				color: #6b7280;
				margin: 0;
			}

			/* Type badge */
			.demo-badge {
				display: inline-block;
				padding: 0.15em 0.6em;
				border-radius: 9999px;
				font-size: 0.7em;
				font-weight: 600;
				text-transform: capitalize;
			}
			.demo-badge.single { background: #f3f4f6; color: #374151; }
			.demo-badge.superset { background: #dbeafe; color: #1d4ed8; }
			.demo-badge.circuit { background: #ede9fe; color: #6d28d9; }

			/* Chevron */
			.demo-chevron {
				color: #9ca3af;
				transition: transform 0.2s;
				flex-shrink: 0;
			}
			.demo-block.open .demo-chevron {
				transform: rotate(180deg);
			}

			/* Block body (sets) */
			.demo-block-body {
				display: none;
				padding: 0.5em 1em;
				border-top: 1px solid #f3f4f6;
				background: #fff;
			}
			.demo-block.open .demo-block-body {
				display: block;
			}

			/* Set row */
			.demo-set {
				display: flex;
				align-items: center;
				gap: 0.75em;
				padding: 0.6em 0;
				border-bottom: 1px solid #f9fafb;
			}
			.demo-set:last-child {
				border-bottom: none;
			}
			.demo-set-num {
				width: 28px;
				height: 28px;
				border-radius: 50%;
				background: #f3f4f6;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 0.8em;
				font-weight: 700;
				color: #4b5563;
				flex-shrink: 0;
			}
			.demo-set-movements {
				flex: 1;
				display: flex;
				flex-wrap: wrap;
				gap: 0.25em 1em;
			}
			.demo-movement {
				display: flex;
				align-items: center;
				gap: 0.35em;
				font-size: 0.9em;
			}
			.demo-movement-name {
				color: #111827;
				font-weight: 500;
			}
			.demo-weight {
				font-weight: 700;
				color: #2563eb;
			}
			.demo-reps {
				font-weight: 700;
				color: #4b5563;
			}
			.demo-times {
				color: #9ca3af;
			}
			.demo-rest-badge {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: 0.2em;
				padding: 0.3em 0.6em;
				background: #fef3c7;
				color: #d97706;
				border-radius: 9999px;
				font-size: 0.78em;
				font-weight: 700;
				flex-shrink: 0;
				min-width: 2.5em;
			}
			.demo-rest-badge .demo-clock {
				font-size: 0.85em;
			}

			/* Cardio metrics */
			.demo-cardio-metrics {
				display: flex;
				flex-wrap: wrap;
				gap: 1em;
				padding: 0.5em 0;
				font-size: 0.9em;
			}
			.demo-cardio-label {
				color: #4b5563;
			}
			.demo-cardio-value {
				font-weight: 700;
				color: #2563eb;
			}

			/* Exercise summary line (expanded single block) */
			.demo-exercise-line {
				display: flex;
				align-items: center;
				gap: 0.5em;
				flex-wrap: wrap;
				padding: 0.6em 1em 0.25em;
			}
			.demo-exercise-name-lg {
				font-weight: 600;
				font-size: 1.05em;
				color: #111827;
			}

			/* Volume & reps pill badges */
			.demo-volume-badge {
				display: inline-block;
				padding: 0.15em 0.6em;
				background: #dbeafe;
				color: #1d4ed8;
				border-radius: 9999px;
				font-size: 0.75em;
				font-weight: 600;
			}
			.demo-reps-badge {
				display: inline-block;
				padding: 0.15em 0.6em;
				background: #f3f4f6;
				color: #374151;
				border-radius: 9999px;
				font-size: 0.75em;
				font-weight: 600;
			}

			/* SETS section header */
			.demo-sets-header {
				font-size: 0.7em;
				font-weight: 600;
				color: #9ca3af;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				padding: 0.5em 1em 0.25em;
			}

			/* Compound exercise list (superset/circuit) */
			.demo-compound-wrap {
				padding: 0.4em 1em 0;
			}
			.demo-compound-exercise {
				display: flex;
				align-items: flex-start;
				gap: 0.5em;
				padding: 0.2em 0;
			}
			.demo-connector-col {
				display: flex;
				flex-direction: column;
				align-items: center;
				width: 10px;
				padding-top: 0.45em;
			}
			.demo-connector-dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
				flex-shrink: 0;
			}
			.demo-connector-dot.superset { background: #93c5fd; }
			.demo-connector-dot.circuit { background: #c4b5fd; }
			.demo-connector-dot.single { background: #d1d5db; }
			.demo-connector-line {
				width: 2px;
				height: 20px;
			}
			.demo-connector-line.superset { background: #93c5fd; }
			.demo-connector-line.circuit { background: #c4b5fd; }
			.demo-compound-info {
				display: flex;
				align-items: center;
				gap: 0.4em;
				flex-wrap: wrap;
			}
			.demo-exercise-name-md {
				font-weight: 600;
				font-size: 0.95em;
				color: #111827;
			}

			/* Session title */
			.demo-session-title {
				font-size: 0.9em;
				font-weight: 600;
				color: #2E3842;
				margin-bottom: 1em;
				padding-bottom: 0.5em;
				border-bottom: 1px solid #e5e7eb;
			}
		</style>

		<!-- Demo logic -->
		<script>
			var demoAttempts = 2;

			var exampleNotes = [
				"Bench press 4x10 80kg rest 1min30\nIncline dumbbell press 3x12 26kg rest 1min\nSuperset:\n  Cable fly 3x15 10kg\n  Push ups 3x20\n  rest 45s\nRunning 25min 4.5km",
				"Squat 5x5 100kg rest 2min\nRomanian deadlift 4x10 70kg rest 1min30\nSuperset:\n  Leg curl 3x12 40kg\n  Leg extension 3x12 35kg\n  rest 1min\nCalf raises 4x15 60kg rest 45s",
				"Pull ups 4x8 rest 1min30\nBarbell row 4x10 60kg rest 1min\nSuperset:\n  Face pull 3x15 15kg\n  Hammer curl 3x12 14kg\n  rest 45s\nRunning intervals 20min: 4x(2min fast + 1min slow)"
			];

			function loadTestData() {
				var testResponse = {"parsed_session":{"session":{"title":"Workout: Chest and Core","start_date_time":"2026-02-12T14:20:55.939818","end_date_time":"2026-02-12T14:45:55.939818","duration_minutes":25,"bodyweight_kg":null,"session_notes":null,"blocks":[{"block_type":"single","block_name":"Bench press","rest_time_between_block":null,"sets":[{"rest_time_between_sets":90,"movements":[{"movement_type":"strength","exercise_name_original":"Bench press","exercise_name_interpreted":"Bench press","reps":10,"weight":80,"additional_reps":3,"weight_for_additional_reps":60,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":90,"movements":[{"movement_type":"strength","exercise_name_original":"Bench press","exercise_name_interpreted":"Bench press","reps":10,"weight":80,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":90,"movements":[{"movement_type":"strength","exercise_name_original":"Bench press","exercise_name_interpreted":"Bench press","reps":10,"weight":80,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":90,"movements":[{"movement_type":"strength","exercise_name_original":"Bench press","exercise_name_interpreted":"Bench press","reps":10,"weight":80,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]}]},{"block_type":"single","block_name":"Incline dumbbell press","rest_time_between_block":null,"sets":[{"rest_time_between_sets":60,"movements":[{"movement_type":"strength","exercise_name_original":"Incline dumbbell press","exercise_name_interpreted":"Incline dumbbell press","reps":12,"weight":26,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":60,"movements":[{"movement_type":"strength","exercise_name_original":"Incline dumbbell press","exercise_name_interpreted":"Incline dumbbell press","reps":12,"weight":26,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":60,"movements":[{"movement_type":"strength","exercise_name_original":"Incline dumbbell press","exercise_name_interpreted":"Incline dumbbell press","reps":12,"weight":26,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]}]},{"block_type":"superset","block_name":"Superset: Cable fly + Push ups","rest_time_between_block":null,"sets":[{"rest_time_between_sets":45,"movements":[{"movement_type":"strength","exercise_name_original":"Cable fly","exercise_name_interpreted":"Cable fly","reps":15,"weight":10,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null},{"movement_type":"strength","exercise_name_original":"Push ups","exercise_name_interpreted":"Push ups","reps":20,"weight":null,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":45,"movements":[{"movement_type":"strength","exercise_name_original":"Cable fly","exercise_name_interpreted":"Cable fly","reps":15,"weight":10,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null},{"movement_type":"strength","exercise_name_original":"Push ups","exercise_name_interpreted":"Push ups","reps":20,"weight":null,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]},{"rest_time_between_sets":45,"movements":[{"movement_type":"strength","exercise_name_original":"Cable fly","exercise_name_interpreted":"Cable fly","reps":15,"weight":10,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null},{"movement_type":"strength","exercise_name_original":"Push ups","exercise_name_interpreted":"Push ups","reps":20,"weight":null,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":null,"velocity_kmh":null,"distance_km":null,"allure_min_per_km":null,"intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]}]},{"block_type":"single","block_name":"Running","rest_time_between_block":null,"sets":[{"rest_time_between_sets":null,"movements":[{"movement_type":"cardio","exercise_name_original":"Running","exercise_name_interpreted":"Running","reps":null,"weight":null,"additional_reps":null,"weight_for_additional_reps":null,"duration_sec":1500,"velocity_kmh":10.8,"distance_km":4.5,"allure_min_per_km":"5:33","intervals":null,"repetitions":null,"rest_time_between_exercices":null,"additional_comments":null}]}]}]}},"inferred_session_type":"strength","blocks_count":4,"processing_time_ms":9872};
				renderSession(testResponse);
			}

			function loadExample() {
				var idx = Math.floor(Math.random() * exampleNotes.length);
				$('#demo-input').val(exampleNotes[idx]).focus();
				$('#demo-error').hide();
			}

			function parseSession() {
				if (demoAttempts <= 0) {
					$('#demo-error').text('You have used all your demo attempts. Thank you for trying!').show();
					return;
				}

				var raw = $('#demo-input').val().trim();
				if (!raw) {
					$('#demo-error').text('Please enter some workout notes first.').show();
					return;
				}

				$('#demo-error').hide();
				$('#btn-text').hide();
				$('#btn-loader').show();
				$('#demo-parse-btn').prop('disabled', true);

				$.ajax({
					url: 'https://ai-trainingdashboard-production.up.railway.app/api/v1/demo/parse',
					method: 'POST',
					contentType: 'application/json',
					dataType: 'json',
					data: JSON.stringify({ raw_text: raw }),
					timeout: 60000,
					success: function(data) {
						demoAttempts--;
						$('#demo-attempts').text(demoAttempts + ' attempt' + (demoAttempts !== 1 ? 's' : '') + ' remaining');
						// Handle case where response is a string
						if (typeof data === 'string') {
							try { data = JSON.parse(data); } catch(e) {
								console.error('Failed to parse response string:', e);
							}
						}
						console.log('Parsed data type:', typeof data);
						console.log('Data keys:', Object.keys(data || {}));
						console.log('Has session?', !!data.session);
						if (data.session) {
							console.log('Session keys:', Object.keys(data.session));
							console.log('Has blocks?', Array.isArray(data.session.blocks), data.session.blocks ? data.session.blocks.length : 0);
						}
						renderSession(data);
					},
					error: function(xhr) {
						if (xhr.status === 429) {
							demoAttempts = 0;
							$('#demo-attempts').text('0 attempts remaining');
							$('#demo-error').text('Rate limit reached. Thank you for trying the demo!').show();
						} else {
							$('#demo-error').text('Something went wrong. Please try again.').show();
						}
					},
					complete: function() {
						$('#btn-text').show();
						$('#btn-loader').hide();
						$('#demo-parse-btn').prop('disabled', false);
						if (demoAttempts <= 0) {
							$('#demo-parse-btn').prop('disabled', true).addClass('disabled');
						}
					}
				});
			}

			function getSession(data) {
				return data && data.parsed_session && data.parsed_session.session ? data.parsed_session.session : null;
			}

			function calcExerciseStats(block, exerciseIndex) {
				var totalVolume = 0, totalReps = 0;
				if (block.sets) {
					block.sets.forEach(function(set) {
						var mov = set.movements[exerciseIndex];
						if (!mov) return;
						var w = mov.weight || 0;
						var r = (typeof mov.reps === 'number') ? mov.reps : 0;
						totalVolume += w * r;
						totalReps += r;
						if (mov.additional_reps && typeof mov.additional_reps === 'number') {
							var aw = (mov.weight_for_additional_reps !== null && mov.weight_for_additional_reps !== undefined) ? mov.weight_for_additional_reps : w;
							totalVolume += aw * mov.additional_reps;
							totalReps += mov.additional_reps;
						}
					});
				}
				return { totalVolume: totalVolume, totalReps: totalReps };
			}

			function formatNumber(n) {
				if (typeof n === 'number') {
					return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
				}
				return n;
			}

			function renderSession(data) {
				var session = getSession(data);
				if (!session || !session.blocks || !session.blocks.length) {
					$('#demo-output').html('<div class="demo-placeholder"><p style="color:#999;">No blocks detected. Try a different input.</p></div>');
					return;
				}

				var blocks = session.blocks;
				var html = '';
				if (session.title) {
					html += '<div class="demo-session-title">' + escHtml(session.title) + '</div>';
				}
				if (session.session_notes) {
					html += '<div style="font-size:0.85em; color:#6b7280; font-style:italic; margin-bottom:1em; padding:0.5em 0.75em; background:#fffbeb; border-radius:8px;">' + escHtml(session.session_notes) + '</div>';
				}

				blocks.forEach(function(block, bi) {
					var type = block.block_type || 'single';
					var exercises = (block.sets && block.sets[0] && block.sets[0].movements) ? block.sets[0].movements : [];
					var totalSets = block.sets ? block.sets.length : 0;
					var isCardio = exercises.length > 0 && exercises[0].movement_type === 'cardio';
					var iconClass = isCardio ? 'cardio' : type;
					var iconChar = isCardio ? '&#9654;' : (type === 'superset' ? '&#9889;' : (type === 'circuit' ? '&#8634;' : '&#9783;'));

					html += '<div class="demo-block" data-block="' + bi + '">';

					// Header
					html += '<div class="demo-block-header" onclick="toggleBlock(' + bi + ')">';
					html += '<div class="demo-block-icon ' + iconClass + '">' + iconChar + '</div>';
					html += '<div class="demo-block-info">';
					html += '<p class="demo-block-name">' + escHtml(block.block_name || 'Block ' + (bi + 1));
					if (!isCardio) {
						html += ' <span class="demo-badge ' + type + '">' + type + '</span>';
					}
					html += '</p>';

					if (isCardio && exercises.length > 0) {
						var m = exercises[0];
						var parts = [];
						if (m.distance_km) parts.push(m.distance_km + ' km');
						if (m.duration_sec) parts.push(Math.floor(m.duration_sec / 60) + ' min');
						if (m.allure_min_per_km) parts.push(m.allure_min_per_km + ' min/km');
						html += '<p class="demo-block-meta">' + parts.join(' &bull; ') + '</p>';
					} else {
						html += '<p class="demo-block-meta">' + exercises.length + ' exercise' + (exercises.length > 1 ? 's' : '') + ' &middot; ' + totalSets + ' set' + (totalSets > 1 ? 's' : '') + '</p>';
					}

					html += '</div>';
					html += '<span class="demo-chevron">&#9660;</span>';
					html += '</div>';

					// Body
					html += '<div class="demo-block-body">';

					if (isCardio && exercises.length > 0) {
						var mv = exercises[0];
						// Main cardio metrics with dot separators
						html += '<div class="demo-cardio-metrics">';
						var metricParts = [];
						if (mv.duration_sec) metricParts.push('<span class="demo-cardio-label">Time: </span><span class="demo-cardio-value">' + Math.floor(mv.duration_sec / 60) + ' min</span>');
						if (mv.distance_km) metricParts.push('<span class="demo-cardio-label">Distance: </span><span class="demo-cardio-value">' + mv.distance_km + ' km</span>');
						if (mv.allure_min_per_km) metricParts.push('<span class="demo-cardio-value">' + mv.allure_min_per_km + ' min/km</span>');
						html += metricParts.map(function(p) { return '<div>' + p + '</div>'; }).join('<div style="font-size:1.2em; color:#6b7280;">&bull;</div>');
						html += '</div>';

						// Intervals section
						if (mv.intervals && mv.intervals.length > 0) {
							var intervalCount = mv.repetitions || mv.intervals.length;
							html += '<div style="border-top:1px solid #f3f4f6; margin-top:0.5em; padding-top:0.5em;">';
							html += '<p style="font-size:0.85em; color:#374151; margin-bottom:0.4em;"><strong>' + intervalCount + '</strong> intervals:</p>';
							html += '<div style="font-size:0.9em; display:flex; align-items:center; gap:0.5em; flex-wrap:wrap;">';
							mv.intervals.forEach(function(intv, ii) {
								if (ii > 0) html += '<span style="color:#6b7280;">+</span>';
								html += '<span style="display:inline-flex; align-items:center; gap:0.3em;">';
								if (intv.duration_sec) {
									var mm = Math.floor(intv.duration_sec / 60);
									var ss = intv.duration_sec % 60;
									html += '<span class="demo-cardio-value">' + mm + ':' + String(ss).padStart(2, '0') + '</span>';
								}
								if (intv.allure_min_per_km) {
									// Numeric pace (contains :) → show as "@ X min/km"
									// Text intensity (e.g. "fast") → show directly
									if (intv.allure_min_per_km.indexOf(':') !== -1) {
										html += '<span style="color:#6b7280;">@</span> <span class="demo-cardio-value">' + intv.allure_min_per_km + ' min/km</span>';
									} else {
										html += '<span class="demo-cardio-value">' + intv.allure_min_per_km + '</span>';
									}
								}
								if (intv.velocity_kmh) html += '<span style="color:#6b7280;">@</span> <span class="demo-cardio-value">' + intv.velocity_kmh + ' km/h</span>';
								html += '</span>';
							});
							html += '</div>';
							html += '</div>';
						}
					} else {
						// Exercise summary with volume/reps badges
						if (type === 'single' && exercises.length === 1) {
							var exStats = calcExerciseStats(block, 0);
							html += '<div class="demo-exercise-line">';
							html += '<span class="demo-exercise-name-lg">' + escHtml(exercises[0].exercise_name_interpreted || exercises[0].exercise_name_original || 'Exercise') + '</span>';
							if (exStats.totalVolume > 0) html += ' <span class="demo-volume-badge">' + formatNumber(Math.round(exStats.totalVolume)) + ' kg</span>';
							if (exStats.totalReps > 0) html += ' <span class="demo-reps-badge">' + exStats.totalReps + ' reps</span>';
							html += '</div>';
						} else if (exercises.length > 1) {
							// Compound: show each exercise with connector dots
							html += '<div class="demo-compound-wrap">';
							exercises.forEach(function(ex, ei) {
								var exStats = calcExerciseStats(block, ei);
								html += '<div class="demo-compound-exercise">';
								html += '<div class="demo-connector-col">';
								html += '<div class="demo-connector-dot ' + type + '"></div>';
								if (ei < exercises.length - 1) html += '<div class="demo-connector-line ' + type + '"></div>';
								html += '</div>';
								html += '<div class="demo-compound-info">';
								html += '<span class="demo-exercise-name-md">' + escHtml(ex.exercise_name_interpreted || ex.exercise_name_original || '') + '</span>';
								if (exStats.totalVolume > 0) html += ' <span class="demo-volume-badge">' + formatNumber(Math.round(exStats.totalVolume)) + ' kg</span>';
								if (exStats.totalReps > 0) html += ' <span class="demo-reps-badge">' + exStats.totalReps + ' reps</span>';
								html += '</div>';
								html += '</div>';
							});
							html += '</div>';
						}

						// SETS header
						html += '<div class="demo-sets-header">Sets</div>';

						// Strength sets
						if (block.sets) {
							block.sets.forEach(function(set, si) {
								html += '<div class="demo-set">';
								html += '<div class="demo-set-num">' + (si + 1) + '</div>';
								html += '<div class="demo-set-movements">';
								set.movements.forEach(function(mov) {
									html += '<div class="demo-movement">';
									if (exercises.length > 1) {
										html += '<span class="demo-movement-name">' + escHtml((mov.exercise_name_interpreted || mov.exercise_name_original || '').split(' ')[0]) + ':</span> ';
									}

									// Determine if additional_reps should be combined or shown separately
									var hasAdditionalWeight = mov.weight_for_additional_reps !== null && mov.weight_for_additional_reps !== undefined;
									var showAdditionalSeparately = mov.additional_reps && hasAdditionalWeight;

									// Calculate display reps (combine when same weight / no separate weight)
									var displayReps = mov.reps;
									if (mov.additional_reps && !hasAdditionalWeight) {
										if (typeof mov.reps === 'number' && typeof mov.additional_reps === 'number') {
											displayReps = mov.reps + mov.additional_reps;
										} else if (typeof mov.reps === 'string' && typeof mov.additional_reps === 'string') {
											displayReps = mov.reps; // can't easily combine time strings, show main only
										}
									}

									var showWeight = mov.weight !== null && mov.weight !== 0 && mov.weight;
									if (showWeight) {
										html += '<span class="demo-weight">' + mov.weight + 'kg</span>';
										if (displayReps) html += '<span class="demo-times"> &times; </span>';
										if (displayReps) html += '<span class="demo-reps">' + displayReps + '</span>';
									} else if (displayReps) {
										html += '<span class="demo-reps">' + displayReps + (typeof displayReps === 'number' ? ' reps' : '') + '</span>';
									}

									// Show additional reps separately only when weight differs (dropsets)
									if (showAdditionalSeparately) {
										html += '<span class="demo-times"> + </span>';
										html += '<span class="demo-weight">' + mov.weight_for_additional_reps + 'kg</span>';
										html += '<span class="demo-times"> &times; </span>';
										html += '<span class="demo-reps">' + mov.additional_reps + '</span>';
									}

									html += '</div>';
								});
								html += '</div>';

								if (set.rest_time_between_sets) {
									html += '<div class="demo-rest-badge"><span class="demo-clock">&#9201;</span> ' + formatRest(set.rest_time_between_sets) + '</div>';
								}
								html += '</div>';
							});
						}
					}

					// Rest between blocks
					if (block.rest_time_between_block) {
						html += '<div style="text-align:center; padding:0.4em 0; font-size:0.8em; color:#6b7280; border-top:1px solid #f3f4f6; margin-top:0.3em;">Rest ' + formatRest(block.rest_time_between_block) + ' before next block</div>';
					}

					html += '</div>'; // body
					html += '</div>'; // block
				});

				$('#demo-output').html(html);
			}

			function toggleBlock(idx) {
				$('.demo-block[data-block="' + idx + '"]').toggleClass('open');
			}

			function formatRest(sec) {
				if (!sec) return '';
				if (sec < 60) return sec + 's';
				var m = Math.floor(sec / 60);
				var s = sec % 60;
				return s === 0 ? m + 'min' : m + ':' + String(s).padStart(2, '0');
			}

			function escHtml(str) {
				if (!str) return '';
				return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
			}
		</script>

	</body>
</html>
